{"ast":null,"code":"\"use strict\";\n\n/*\n * Copyright 2021-2022 the original author or authors.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nrequire(\"core-js/modules/es.regexp.flags.js\");\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function () {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n};\nvar __values = this && this.__values || function (o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator,\n    m = s && o[s],\n    i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n    next: function () {\n      if (o && i >= o.length) o = void 0;\n      return {\n        value: o && o[i++],\n        done: !o\n      };\n    }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.RequestResponseResponderStream = exports.RequestResponseRequesterStream = void 0;\nvar Errors_1 = require(\"./Errors\");\nvar Fragmenter_1 = require(\"./Fragmenter\");\nvar Frames_1 = require(\"./Frames\");\nvar Reassembler = __importStar(require(\"./Reassembler\"));\nvar RequestResponseRequesterStream = /** @class */function () {\n  function RequestResponseRequesterStream(payload, receiver, fragmentSize, leaseManager) {\n    this.payload = payload;\n    this.receiver = receiver;\n    this.fragmentSize = fragmentSize;\n    this.leaseManager = leaseManager;\n    this.streamType = Frames_1.FrameTypes.REQUEST_RESPONSE;\n  }\n  RequestResponseRequesterStream.prototype.handleReady = function (streamId, stream) {\n    var e_1, _a;\n    if (this.done) {\n      return false;\n    }\n    this.streamId = streamId;\n    this.stream = stream;\n    stream.connect(this);\n    if ((0, Fragmenter_1.isFragmentable)(this.payload, this.fragmentSize, Frames_1.FrameTypes.REQUEST_RESPONSE)) {\n      try {\n        for (var _b = __values((0, Fragmenter_1.fragment)(streamId, this.payload, this.fragmentSize, Frames_1.FrameTypes.REQUEST_RESPONSE)), _c = _b.next(); !_c.done; _c = _b.next()) {\n          var frame = _c.value;\n          this.stream.send(frame);\n        }\n      } catch (e_1_1) {\n        e_1 = {\n          error: e_1_1\n        };\n      } finally {\n        try {\n          if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n        } finally {\n          if (e_1) throw e_1.error;\n        }\n      }\n    } else {\n      this.stream.send({\n        type: Frames_1.FrameTypes.REQUEST_RESPONSE,\n        data: this.payload.data,\n        metadata: this.payload.metadata,\n        flags: this.payload.metadata ? Frames_1.Flags.METADATA : 0,\n        streamId: streamId\n      });\n    }\n    if (this.hasExtension) {\n      this.stream.send({\n        type: Frames_1.FrameTypes.EXT,\n        streamId: streamId,\n        extendedContent: this.extendedContent,\n        extendedType: this.extendedType,\n        flags: this.flags\n      });\n    }\n    return true;\n  };\n  RequestResponseRequesterStream.prototype.handleReject = function (error) {\n    if (this.done) {\n      return;\n    }\n    this.done = true;\n    this.receiver.onError(error);\n  };\n  RequestResponseRequesterStream.prototype.handle = function (frame) {\n    var errorMessage;\n    var frameType = frame.type;\n    switch (frameType) {\n      case Frames_1.FrameTypes.PAYLOAD:\n        {\n          var hasComplete = Frames_1.Flags.hasComplete(frame.flags);\n          var hasPayload = Frames_1.Flags.hasNext(frame.flags);\n          if (hasComplete || !Frames_1.Flags.hasFollows(frame.flags)) {\n            this.done = true;\n            this.stream.disconnect(this);\n            if (!hasPayload) {\n              // TODO: add validation no frame in reassembly\n              this.receiver.onComplete();\n              return;\n            }\n            var payload = this.hasFragments ? Reassembler.reassemble(this, frame.data, frame.metadata) : {\n              data: frame.data,\n              metadata: frame.metadata\n            };\n            this.receiver.onNext(payload, true);\n            return;\n          }\n          if (!Reassembler.add(this, frame.data, frame.metadata)) {\n            errorMessage = \"Unexpected fragment size\";\n            break;\n          }\n          return;\n        }\n      case Frames_1.FrameTypes.ERROR:\n        {\n          this.done = true;\n          this.stream.disconnect(this);\n          Reassembler.cancel(this);\n          this.receiver.onError(new Errors_1.RSocketError(frame.code, frame.message));\n          return;\n        }\n      case Frames_1.FrameTypes.EXT:\n        {\n          if (this.hasFragments) {\n            errorMessage = \"Unexpected frame type [\".concat(frameType, \"] during reassembly\");\n            break;\n          }\n          this.receiver.onExtension(frame.extendedType, frame.extendedContent, Frames_1.Flags.hasIgnore(frame.flags));\n          return;\n        }\n      default:\n        {\n          errorMessage = \"Unexpected frame type [\".concat(frameType, \"]\");\n        }\n    }\n    this.close(new Errors_1.RSocketError(Errors_1.ErrorCodes.CANCELED, errorMessage));\n    this.stream.send({\n      type: Frames_1.FrameTypes.CANCEL,\n      streamId: this.streamId,\n      flags: Frames_1.Flags.NONE\n    });\n    this.stream.disconnect(this);\n    // TODO: throw an exception if strict frame handling mode\n  };\n\n  RequestResponseRequesterStream.prototype.cancel = function () {\n    var _a;\n    if (this.done) {\n      return;\n    }\n    this.done = true;\n    if (!this.streamId) {\n      (_a = this.leaseManager) === null || _a === void 0 ? void 0 : _a.cancelRequest(this);\n      return;\n    }\n    this.stream.send({\n      type: Frames_1.FrameTypes.CANCEL,\n      flags: Frames_1.Flags.NONE,\n      streamId: this.streamId\n    });\n    this.stream.disconnect(this);\n    Reassembler.cancel(this);\n  };\n  RequestResponseRequesterStream.prototype.onExtension = function (extendedType, content, canBeIgnored) {\n    if (this.done) {\n      return;\n    }\n    if (!this.streamId) {\n      this.hasExtension = true;\n      this.extendedType = extendedType;\n      this.extendedContent = content;\n      this.flags = canBeIgnored ? Frames_1.Flags.IGNORE : Frames_1.Flags.NONE;\n      return;\n    }\n    this.stream.send({\n      streamId: this.streamId,\n      type: Frames_1.FrameTypes.EXT,\n      extendedType: extendedType,\n      extendedContent: content,\n      flags: canBeIgnored ? Frames_1.Flags.IGNORE : Frames_1.Flags.NONE\n    });\n  };\n  RequestResponseRequesterStream.prototype.close = function (error) {\n    if (this.done) {\n      return;\n    }\n    this.done = true;\n    Reassembler.cancel(this);\n    if (error) {\n      this.receiver.onError(error);\n    } else {\n      this.receiver.onComplete();\n    }\n  };\n  return RequestResponseRequesterStream;\n}();\nexports.RequestResponseRequesterStream = RequestResponseRequesterStream;\nvar RequestResponseResponderStream = /** @class */function () {\n  function RequestResponseResponderStream(streamId, stream, fragmentSize, handler, frame) {\n    this.streamId = streamId;\n    this.stream = stream;\n    this.fragmentSize = fragmentSize;\n    this.handler = handler;\n    this.streamType = Frames_1.FrameTypes.REQUEST_RESPONSE;\n    stream.connect(this);\n    if (Frames_1.Flags.hasFollows(frame.flags)) {\n      Reassembler.add(this, frame.data, frame.metadata);\n      return;\n    }\n    var payload = {\n      data: frame.data,\n      metadata: frame.metadata\n    };\n    try {\n      this.receiver = handler(payload, this);\n    } catch (error) {\n      this.onError(error);\n    }\n  }\n  RequestResponseResponderStream.prototype.handle = function (frame) {\n    var _a;\n    var errorMessage;\n    if (!this.receiver || this.hasFragments) {\n      if (frame.type === Frames_1.FrameTypes.PAYLOAD) {\n        if (Frames_1.Flags.hasFollows(frame.flags)) {\n          if (Reassembler.add(this, frame.data, frame.metadata)) {\n            return;\n          }\n          errorMessage = \"Unexpected fragment size\";\n        } else {\n          var payload = Reassembler.reassemble(this, frame.data, frame.metadata);\n          try {\n            this.receiver = this.handler(payload, this);\n          } catch (error) {\n            this.onError(error);\n          }\n          return;\n        }\n      } else {\n        errorMessage = \"Unexpected frame type [\".concat(frame.type, \"] during reassembly\");\n      }\n    } else if (frame.type === Frames_1.FrameTypes.EXT) {\n      this.receiver.onExtension(frame.extendedType, frame.extendedContent, Frames_1.Flags.hasIgnore(frame.flags));\n      return;\n    } else {\n      errorMessage = \"Unexpected frame type [\".concat(frame.type, \"]\");\n    }\n    this.done = true;\n    (_a = this.receiver) === null || _a === void 0 ? void 0 : _a.cancel();\n    if (frame.type !== Frames_1.FrameTypes.CANCEL && frame.type !== Frames_1.FrameTypes.ERROR) {\n      this.stream.send({\n        type: Frames_1.FrameTypes.ERROR,\n        flags: Frames_1.Flags.NONE,\n        code: Errors_1.ErrorCodes.CANCELED,\n        message: errorMessage,\n        streamId: this.streamId\n      });\n    }\n    this.stream.disconnect(this);\n    Reassembler.cancel(this);\n    // TODO: throws if strict\n  };\n\n  RequestResponseResponderStream.prototype.onError = function (error) {\n    if (this.done) {\n      console.warn(\"Trying to error for the second time. \".concat(error ? \"Dropping error [\".concat(error, \"].\") : \"\"));\n      return;\n    }\n    this.done = true;\n    this.stream.send({\n      type: Frames_1.FrameTypes.ERROR,\n      flags: Frames_1.Flags.NONE,\n      code: error instanceof Errors_1.RSocketError ? error.code : Errors_1.ErrorCodes.APPLICATION_ERROR,\n      message: error.message,\n      streamId: this.streamId\n    });\n    this.stream.disconnect(this);\n  };\n  RequestResponseResponderStream.prototype.onNext = function (payload, isCompletion) {\n    var e_2, _a;\n    if (this.done) {\n      return;\n    }\n    this.done = true;\n    // TODO: add payload size validation\n    if ((0, Fragmenter_1.isFragmentable)(payload, this.fragmentSize, Frames_1.FrameTypes.PAYLOAD)) {\n      try {\n        for (var _b = __values((0, Fragmenter_1.fragment)(this.streamId, payload, this.fragmentSize, Frames_1.FrameTypes.PAYLOAD, true)), _c = _b.next(); !_c.done; _c = _b.next()) {\n          var frame = _c.value;\n          this.stream.send(frame);\n        }\n      } catch (e_2_1) {\n        e_2 = {\n          error: e_2_1\n        };\n      } finally {\n        try {\n          if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n        } finally {\n          if (e_2) throw e_2.error;\n        }\n      }\n    } else {\n      this.stream.send({\n        type: Frames_1.FrameTypes.PAYLOAD,\n        flags: Frames_1.Flags.NEXT | Frames_1.Flags.COMPLETE | (payload.metadata ? Frames_1.Flags.METADATA : 0),\n        data: payload.data,\n        metadata: payload.metadata,\n        streamId: this.streamId\n      });\n    }\n    this.stream.disconnect(this);\n  };\n  RequestResponseResponderStream.prototype.onComplete = function () {\n    if (this.done) {\n      return;\n    }\n    this.done = true;\n    this.stream.send({\n      type: Frames_1.FrameTypes.PAYLOAD,\n      flags: Frames_1.Flags.COMPLETE,\n      streamId: this.streamId,\n      data: null,\n      metadata: null\n    });\n    this.stream.disconnect(this);\n  };\n  RequestResponseResponderStream.prototype.onExtension = function (extendedType, content, canBeIgnored) {\n    if (this.done) {\n      return;\n    }\n    this.stream.send({\n      type: Frames_1.FrameTypes.EXT,\n      streamId: this.streamId,\n      flags: canBeIgnored ? Frames_1.Flags.IGNORE : Frames_1.Flags.NONE,\n      extendedType: extendedType,\n      extendedContent: content\n    });\n  };\n  RequestResponseResponderStream.prototype.close = function (error) {\n    var _a;\n    if (this.done) {\n      console.warn(\"Trying to close for the second time. \".concat(error ? \"Dropping error [\".concat(error, \"].\") : \"\"));\n      return;\n    }\n    Reassembler.cancel(this);\n    (_a = this.receiver) === null || _a === void 0 ? void 0 : _a.cancel();\n  };\n  return RequestResponseResponderStream;\n}();\nexports.RequestResponseResponderStream = RequestResponseResponderStream;","map":{"version":3,"names":["require","Errors_1","Fragmenter_1","Frames_1","Reassembler","__importStar","RequestResponseRequesterStream","payload","receiver","fragmentSize","leaseManager","streamType","FrameTypes","REQUEST_RESPONSE","prototype","handleReady","streamId","stream","done","connect","isFragmentable","_b","__values","fragment","_c","next","frame","value","send","type","data","metadata","flags","Flags","METADATA","hasExtension","EXT","extendedContent","extendedType","handleReject","error","onError","handle","errorMessage","frameType","PAYLOAD","hasComplete","hasPayload","hasNext","hasFollows","disconnect","onComplete","hasFragments","reassemble","onNext","add","ERROR","cancel","RSocketError","code","message","concat","onExtension","hasIgnore","close","ErrorCodes","CANCELED","CANCEL","NONE","_a","cancelRequest","content","canBeIgnored","IGNORE","exports","RequestResponseResponderStream","handler","console","warn","APPLICATION_ERROR","isCompletion","NEXT","COMPLETE"],"sources":["../src/RequestResponseStream.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}