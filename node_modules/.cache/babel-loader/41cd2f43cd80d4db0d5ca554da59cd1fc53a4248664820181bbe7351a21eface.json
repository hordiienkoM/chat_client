{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { obtainSlot } from '../utils';\nexport function decorator(setupFunction) {\n  return function (proto, name) {\n    const slot = obtainSlot(proto);\n    const map = slot.obtainMap('setup');\n    map.set(name, {\n      setupFunction\n    });\n  };\n}\nconst isPromise = v => v instanceof Promise;\n//(v: any) => typeof v === 'object' && typeof v.then === 'function'\nexport function build(cons, optionBuilder) {\n  const slot = obtainSlot(cons.prototype);\n  const map = slot.obtainMap('setup');\n  if (map.size === 0) {\n    return;\n  }\n  const setup = function (props, ctx) {\n    const setupData = {};\n    let promises = null;\n    for (const name of map.keys()) {\n      const setupState = map.get(name).setupFunction(props, ctx);\n      if (isPromise(setupState)) {\n        promises !== null && promises !== void 0 ? promises : promises = [];\n        promises.push(setupState.then(v => {\n          setupData[name] = v;\n        }));\n      } else {\n        setupData[name] = setupState;\n      }\n    }\n    if (Array.isArray(promises)) {\n      return Promise.all(promises).then(() => {\n        return setupData;\n      });\n    } else {\n      return setupData;\n    }\n  };\n  optionBuilder.setup = setup;\n}","map":{"version":3,"names":["obtainSlot","decorator","setupFunction","proto","name","slot","map","obtainMap","set","isPromise","v","Promise","build","cons","optionBuilder","prototype","size","setup","props","ctx","setupData","promises","keys","setupState","get","push","then","Array","isArray","all"],"sources":["../../../src/option/setup.ts"],"sourcesContent":[null],"mappings":";AAGA,SAASA,UAAU,QAAQ,UAAU;AAMrC,OAAM,SAAUC,SAASA,CAACC,aAAkC;EACxD,OAAO,UAAUC,KAAU,EAAEC,IAAY;IACrC,MAAMC,IAAI,GAAGL,UAAU,CAACG,KAAK,CAAC;IAC9B,MAAMG,GAAG,GAAGD,IAAI,CAACE,SAAS,CAAC,OAAO,CAAC;IACnCD,GAAG,CAACE,GAAG,CAACJ,IAAI,EAAE;MACVF;KACH,CAAC;EACN,CAAC;AAEL;AAEA,MAAMO,SAAS,GAAIC,CAAM,IAAwBA,CAAC,YAAYC,OAAO;AACrE;AAEA,OAAM,SAAUC,KAAKA,CAACC,IAAU,EAAEC,aAA4B;EAC1D,MAAMT,IAAI,GAAGL,UAAU,CAACa,IAAI,CAACE,SAAS,CAAC;EACvC,MAAMT,GAAG,GAAGD,IAAI,CAACE,SAAS,CAAC,OAAO,CAAC;EACnC,IAAID,GAAG,CAACU,IAAI,KAAK,CAAC,EAAE;IAChB;;EAEJ,MAAMC,KAAK,GAAwB,SAAAA,CAAUC,KAAK,EAAEC,GAAG;IACnD,MAAMC,SAAS,GAAwB,EAAE;IACzC,IAAIC,QAAQ,GAA0B,IAAI;IAC1C,KAAK,MAAMjB,IAAI,IAAIE,GAAG,CAACgB,IAAI,EAAE,EAAE;MAC3B,MAAMC,UAAU,GAAGjB,GAAG,CAACkB,GAAG,CAACpB,IAAI,CAAE,CAACF,aAAa,CAACgB,KAAK,EAAEC,GAAG,CAAC;MAC3D,IAAIV,SAAS,CAACc,UAAU,CAAC,EAAE;QACvBF,QAAQ,aAARA,QAAQ,cAARA,QAAQ,GAARA,QAAQ,GAAK,EAAE;QACfA,QAAQ,CAACI,IAAI,CAACF,UAAU,CAACG,IAAI,CAAEhB,CAAC,IAAI;UAChCU,SAAS,CAAChB,IAAI,CAAC,GAAGM,CAAC;QACvB,CAAC,CAAC,CAAC;OACN,MAAM;QACHU,SAAS,CAAChB,IAAI,CAAC,GAAGmB,UAAU;;;IAGpC,IAAII,KAAK,CAACC,OAAO,CAACP,QAAQ,CAAC,EAAE;MACzB,OAAOV,OAAO,CAACkB,GAAG,CAACR,QAAQ,CAAC,CAACK,IAAI,CAAC,MAAK;QACnC,OAAON,SAAS;MACpB,CAAC,CAAC;KACL,MAAM;MACH,OAAOA,SAAS;;EAExB,CAAC;EACDN,aAAa,CAACG,KAAK,GAAGA,KAAK;AAC/B"},"metadata":{},"sourceType":"module","externalDependencies":[]}