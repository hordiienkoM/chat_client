{"ast":null,"code":"\"use strict\";\n\n/*\n * Copyright 2021-2022 the original author or authors.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.cancel = exports.reassemble = exports.add = void 0;\nfunction add(holder, dataFragment, metadataFragment) {\n  if (!holder.hasFragments) {\n    holder.hasFragments = true;\n    holder.data = dataFragment;\n    if (metadataFragment) {\n      holder.metadata = metadataFragment;\n    }\n    return true;\n  }\n  // TODO: add validation\n  holder.data = holder.data ? Buffer.concat([holder.data, dataFragment]) : dataFragment;\n  if (holder.metadata && metadataFragment) {\n    holder.metadata = Buffer.concat([holder.metadata, metadataFragment]);\n  }\n  return true;\n}\nexports.add = add;\nfunction reassemble(holder, dataFragment, metadataFragment) {\n  // TODO: add validation\n  holder.hasFragments = false;\n  var data = holder.data ? Buffer.concat([holder.data, dataFragment]) : dataFragment;\n  holder.data = undefined;\n  if (holder.metadata) {\n    var metadata = metadataFragment ? Buffer.concat([holder.metadata, metadataFragment]) : holder.metadata;\n    holder.metadata = undefined;\n    return {\n      data: data,\n      metadata: metadata\n    };\n  }\n  return {\n    data: data\n  };\n}\nexports.reassemble = reassemble;\nfunction cancel(holder) {\n  holder.hasFragments = false;\n  holder.data = undefined;\n  holder.metadata = undefined;\n}\nexports.cancel = cancel;","map":{"version":3,"names":["add","holder","dataFragment","metadataFragment","hasFragments","data","metadata","Buffer","concat","exports","reassemble","undefined","cancel"],"sources":["../src/Reassembler.ts"],"sourcesContent":[null],"mappings":";;AAAA;;;;;;;;;;;;;;;;;;;AAwBA,SAAgBA,GAAGA,CACjBC,MAAuB,EACvBC,YAAoB,EACpBC,gBAA4C;EAE5C,IAAI,CAACF,MAAM,CAACG,YAAY,EAAE;IACxBH,MAAM,CAACG,YAAY,GAAG,IAAI;IAC1BH,MAAM,CAACI,IAAI,GAAGH,YAAY;IAC1B,IAAIC,gBAAgB,EAAE;MACpBF,MAAM,CAACK,QAAQ,GAAGH,gBAAgB;;IAEpC,OAAO,IAAI;;EAGb;EACAF,MAAM,CAACI,IAAI,GAAGJ,MAAM,CAACI,IAAI,GACrBE,MAAM,CAACC,MAAM,CAAC,CAACP,MAAM,CAACI,IAAI,EAAEH,YAAY,CAAC,CAAC,GAC1CA,YAAY;EAChB,IAAID,MAAM,CAACK,QAAQ,IAAIH,gBAAgB,EAAE;IACvCF,MAAM,CAACK,QAAQ,GAAGC,MAAM,CAACC,MAAM,CAAC,CAACP,MAAM,CAACK,QAAQ,EAAEH,gBAAgB,CAAC,CAAC;;EAGtE,OAAO,IAAI;AACb;AAvBAM,OAAA,CAAAT,GAAA,GAAAA,GAAA;AAyBA,SAAgBU,UAAUA,CACxBT,MAAuB,EACvBC,YAAoB,EACpBC,gBAA2C;EAE3C;EACAF,MAAM,CAACG,YAAY,GAAG,KAAK;EAE3B,IAAMC,IAAI,GAAGJ,MAAM,CAACI,IAAI,GACpBE,MAAM,CAACC,MAAM,CAAC,CAACP,MAAM,CAACI,IAAI,EAAEH,YAAY,CAAC,CAAC,GAC1CA,YAAY;EAEhBD,MAAM,CAACI,IAAI,GAAGM,SAAS;EAEvB,IAAIV,MAAM,CAACK,QAAQ,EAAE;IACnB,IAAMA,QAAQ,GAAGH,gBAAgB,GAC7BI,MAAM,CAACC,MAAM,CAAC,CAACP,MAAM,CAACK,QAAQ,EAAEH,gBAAgB,CAAC,CAAC,GAClDF,MAAM,CAACK,QAAQ;IAEnBL,MAAM,CAACK,QAAQ,GAAGK,SAAS;IAE3B,OAAO;MACLN,IAAI,EAAAA,IAAA;MACJC,QAAQ,EAAAA;KACT;;EAGH,OAAO;IACLD,IAAI,EAAAA;GACL;AACH;AA9BAI,OAAA,CAAAC,UAAA,GAAAA,UAAA;AAgCA,SAAgBE,MAAMA,CAACX,MAAuB;EAC5CA,MAAM,CAACG,YAAY,GAAG,KAAK;EAC3BH,MAAM,CAACI,IAAI,GAAGM,SAAS;EACvBV,MAAM,CAACK,QAAQ,GAAGK,SAAS;AAC7B;AAJAF,OAAA,CAAAG,MAAA,GAAAA,MAAA"},"metadata":{},"sourceType":"script","externalDependencies":[]}