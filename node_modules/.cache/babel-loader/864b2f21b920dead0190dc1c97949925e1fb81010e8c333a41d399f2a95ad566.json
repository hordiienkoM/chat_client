{"ast":null,"code":"\"use strict\";\n\n/*\n * Copyright 2021-2022 the original author or authors.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nrequire(\"core-js/modules/es.regexp.flags.js\");\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function () {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n};\nvar __values = this && this.__values || function (o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator,\n    m = s && o[s],\n    i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n    next: function () {\n      if (o && i >= o.length) o = void 0;\n      return {\n        value: o && o[i++],\n        done: !o\n      };\n    }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.RequestStreamResponderStream = exports.RequestStreamRequesterStream = void 0;\nvar Errors_1 = require(\"./Errors\");\nvar Fragmenter_1 = require(\"./Fragmenter\");\nvar Frames_1 = require(\"./Frames\");\nvar Reassembler = __importStar(require(\"./Reassembler\"));\nvar RequestStreamRequesterStream = /** @class */function () {\n  function RequestStreamRequesterStream(payload, receiver, fragmentSize, initialRequestN, leaseManager) {\n    this.payload = payload;\n    this.receiver = receiver;\n    this.fragmentSize = fragmentSize;\n    this.initialRequestN = initialRequestN;\n    this.leaseManager = leaseManager;\n    this.streamType = Frames_1.FrameTypes.REQUEST_STREAM;\n    // TODO: add payload size validation\n  }\n\n  RequestStreamRequesterStream.prototype.handleReady = function (streamId, stream) {\n    var e_1, _a;\n    if (this.done) {\n      return false;\n    }\n    this.streamId = streamId;\n    this.stream = stream;\n    stream.connect(this);\n    if ((0, Fragmenter_1.isFragmentable)(this.payload, this.fragmentSize, Frames_1.FrameTypes.REQUEST_STREAM)) {\n      try {\n        for (var _b = __values((0, Fragmenter_1.fragmentWithRequestN)(streamId, this.payload, this.fragmentSize, Frames_1.FrameTypes.REQUEST_STREAM, this.initialRequestN)), _c = _b.next(); !_c.done; _c = _b.next()) {\n          var frame = _c.value;\n          this.stream.send(frame);\n        }\n      } catch (e_1_1) {\n        e_1 = {\n          error: e_1_1\n        };\n      } finally {\n        try {\n          if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n        } finally {\n          if (e_1) throw e_1.error;\n        }\n      }\n    } else {\n      this.stream.send({\n        type: Frames_1.FrameTypes.REQUEST_STREAM,\n        data: this.payload.data,\n        metadata: this.payload.metadata,\n        requestN: this.initialRequestN,\n        flags: this.payload.metadata !== undefined ? Frames_1.Flags.METADATA : 0,\n        streamId: streamId\n      });\n    }\n    if (this.hasExtension) {\n      this.stream.send({\n        type: Frames_1.FrameTypes.EXT,\n        streamId: streamId,\n        extendedContent: this.extendedContent,\n        extendedType: this.extendedType,\n        flags: this.flags\n      });\n    }\n    return true;\n  };\n  RequestStreamRequesterStream.prototype.handleReject = function (error) {\n    if (this.done) {\n      return;\n    }\n    this.done = true;\n    this.receiver.onError(error);\n  };\n  RequestStreamRequesterStream.prototype.handle = function (frame) {\n    var errorMessage;\n    var frameType = frame.type;\n    switch (frameType) {\n      case Frames_1.FrameTypes.PAYLOAD:\n        {\n          var hasComplete = Frames_1.Flags.hasComplete(frame.flags);\n          var hasNext = Frames_1.Flags.hasNext(frame.flags);\n          if (hasComplete || !Frames_1.Flags.hasFollows(frame.flags)) {\n            if (hasComplete) {\n              this.done = true;\n              this.stream.disconnect(this);\n              if (!hasNext) {\n                // TODO: add validation no frame in reassembly\n                this.receiver.onComplete();\n                return;\n              }\n            }\n            var payload = this.hasFragments ? Reassembler.reassemble(this, frame.data, frame.metadata) : {\n              data: frame.data,\n              metadata: frame.metadata\n            };\n            this.receiver.onNext(payload, hasComplete);\n            return;\n          }\n          if (!Reassembler.add(this, frame.data, frame.metadata)) {\n            errorMessage = \"Unexpected fragment size\";\n            break;\n          }\n          return;\n        }\n      case Frames_1.FrameTypes.ERROR:\n        {\n          this.done = true;\n          this.stream.disconnect(this);\n          Reassembler.cancel(this);\n          this.receiver.onError(new Errors_1.RSocketError(frame.code, frame.message));\n          return;\n        }\n      case Frames_1.FrameTypes.EXT:\n        {\n          if (this.hasFragments) {\n            errorMessage = \"Unexpected frame type [\".concat(frameType, \"] during reassembly\");\n            break;\n          }\n          this.receiver.onExtension(frame.extendedType, frame.extendedContent, Frames_1.Flags.hasIgnore(frame.flags));\n          return;\n        }\n      default:\n        {\n          errorMessage = \"Unexpected frame type [\".concat(frameType, \"]\");\n        }\n    }\n    this.close(new Errors_1.RSocketError(Errors_1.ErrorCodes.CANCELED, errorMessage));\n    this.stream.send({\n      type: Frames_1.FrameTypes.CANCEL,\n      streamId: this.streamId,\n      flags: Frames_1.Flags.NONE\n    });\n    this.stream.disconnect(this);\n    // TODO: throw an exception if strict frame handling mode\n  };\n\n  RequestStreamRequesterStream.prototype.request = function (n) {\n    if (this.done) {\n      return;\n    }\n    if (!this.streamId) {\n      this.initialRequestN += n;\n      return;\n    }\n    this.stream.send({\n      type: Frames_1.FrameTypes.REQUEST_N,\n      flags: Frames_1.Flags.NONE,\n      requestN: n,\n      streamId: this.streamId\n    });\n  };\n  RequestStreamRequesterStream.prototype.cancel = function () {\n    var _a;\n    if (this.done) {\n      return;\n    }\n    this.done = true;\n    if (!this.streamId) {\n      (_a = this.leaseManager) === null || _a === void 0 ? void 0 : _a.cancelRequest(this);\n      return;\n    }\n    this.stream.send({\n      type: Frames_1.FrameTypes.CANCEL,\n      flags: Frames_1.Flags.NONE,\n      streamId: this.streamId\n    });\n    this.stream.disconnect(this);\n    Reassembler.cancel(this);\n  };\n  RequestStreamRequesterStream.prototype.onExtension = function (extendedType, content, canBeIgnored) {\n    if (this.done) {\n      return;\n    }\n    if (!this.streamId) {\n      this.hasExtension = true;\n      this.extendedType = extendedType;\n      this.extendedContent = content;\n      this.flags = canBeIgnored ? Frames_1.Flags.IGNORE : Frames_1.Flags.NONE;\n      return;\n    }\n    this.stream.send({\n      streamId: this.streamId,\n      type: Frames_1.FrameTypes.EXT,\n      extendedType: extendedType,\n      extendedContent: content,\n      flags: canBeIgnored ? Frames_1.Flags.IGNORE : Frames_1.Flags.NONE\n    });\n  };\n  RequestStreamRequesterStream.prototype.close = function (error) {\n    if (this.done) {\n      return;\n    }\n    this.done = true;\n    Reassembler.cancel(this);\n    if (error) {\n      this.receiver.onError(error);\n    } else {\n      this.receiver.onComplete();\n    }\n  };\n  return RequestStreamRequesterStream;\n}();\nexports.RequestStreamRequesterStream = RequestStreamRequesterStream;\nvar RequestStreamResponderStream = /** @class */function () {\n  function RequestStreamResponderStream(streamId, stream, fragmentSize, handler, frame) {\n    this.streamId = streamId;\n    this.stream = stream;\n    this.fragmentSize = fragmentSize;\n    this.handler = handler;\n    this.streamType = Frames_1.FrameTypes.REQUEST_STREAM;\n    stream.connect(this);\n    if (Frames_1.Flags.hasFollows(frame.flags)) {\n      this.initialRequestN = frame.requestN;\n      Reassembler.add(this, frame.data, frame.metadata);\n      return;\n    }\n    var payload = {\n      data: frame.data,\n      metadata: frame.metadata\n    };\n    try {\n      this.receiver = handler(payload, frame.requestN, this);\n    } catch (error) {\n      this.onError(error);\n    }\n  }\n  RequestStreamResponderStream.prototype.handle = function (frame) {\n    var _a;\n    var errorMessage;\n    if (!this.receiver || this.hasFragments) {\n      if (frame.type === Frames_1.FrameTypes.PAYLOAD) {\n        if (Frames_1.Flags.hasFollows(frame.flags)) {\n          if (Reassembler.add(this, frame.data, frame.metadata)) {\n            return;\n          }\n          errorMessage = \"Unexpected frame size\";\n        } else {\n          var payload = Reassembler.reassemble(this, frame.data, frame.metadata);\n          try {\n            this.receiver = this.handler(payload, this.initialRequestN, this);\n          } catch (error) {\n            this.onError(error);\n          }\n          return;\n        }\n      } else {\n        errorMessage = \"Unexpected frame type [\".concat(frame.type, \"] during reassembly\");\n      }\n    } else if (frame.type === Frames_1.FrameTypes.REQUEST_N) {\n      this.receiver.request(frame.requestN);\n      return;\n    } else if (frame.type === Frames_1.FrameTypes.EXT) {\n      this.receiver.onExtension(frame.extendedType, frame.extendedContent, Frames_1.Flags.hasIgnore(frame.flags));\n      return;\n    } else {\n      errorMessage = \"Unexpected frame type [\".concat(frame.type, \"]\");\n    }\n    this.done = true;\n    Reassembler.cancel(this);\n    (_a = this.receiver) === null || _a === void 0 ? void 0 : _a.cancel();\n    if (frame.type !== Frames_1.FrameTypes.CANCEL && frame.type !== Frames_1.FrameTypes.ERROR) {\n      this.stream.send({\n        type: Frames_1.FrameTypes.ERROR,\n        flags: Frames_1.Flags.NONE,\n        code: Errors_1.ErrorCodes.CANCELED,\n        message: errorMessage,\n        streamId: this.streamId\n      });\n    }\n    this.stream.disconnect(this);\n    // TODO: throws if strict\n  };\n\n  RequestStreamResponderStream.prototype.onError = function (error) {\n    if (this.done) {\n      console.warn(\"Trying to error for the second time. \".concat(error ? \"Dropping error [\".concat(error, \"].\") : \"\"));\n      return;\n    }\n    this.done = true;\n    this.stream.send({\n      type: Frames_1.FrameTypes.ERROR,\n      flags: Frames_1.Flags.NONE,\n      code: error instanceof Errors_1.RSocketError ? error.code : Errors_1.ErrorCodes.APPLICATION_ERROR,\n      message: error.message,\n      streamId: this.streamId\n    });\n    this.stream.disconnect(this);\n  };\n  RequestStreamResponderStream.prototype.onNext = function (payload, isCompletion) {\n    var e_2, _a;\n    if (this.done) {\n      return;\n    }\n    if (isCompletion) {\n      this.done = true;\n    }\n    // TODO: add payload size validation\n    if ((0, Fragmenter_1.isFragmentable)(payload, this.fragmentSize, Frames_1.FrameTypes.PAYLOAD)) {\n      try {\n        for (var _b = __values((0, Fragmenter_1.fragment)(this.streamId, payload, this.fragmentSize, Frames_1.FrameTypes.PAYLOAD, isCompletion)), _c = _b.next(); !_c.done; _c = _b.next()) {\n          var frame = _c.value;\n          this.stream.send(frame);\n        }\n      } catch (e_2_1) {\n        e_2 = {\n          error: e_2_1\n        };\n      } finally {\n        try {\n          if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n        } finally {\n          if (e_2) throw e_2.error;\n        }\n      }\n    } else {\n      this.stream.send({\n        type: Frames_1.FrameTypes.PAYLOAD,\n        flags: Frames_1.Flags.NEXT | (isCompletion ? Frames_1.Flags.COMPLETE : Frames_1.Flags.NONE) | (payload.metadata ? Frames_1.Flags.METADATA : Frames_1.Flags.NONE),\n        data: payload.data,\n        metadata: payload.metadata,\n        streamId: this.streamId\n      });\n    }\n    if (isCompletion) {\n      this.stream.disconnect(this);\n    }\n  };\n  RequestStreamResponderStream.prototype.onComplete = function () {\n    if (this.done) {\n      return;\n    }\n    this.done = true;\n    this.stream.send({\n      type: Frames_1.FrameTypes.PAYLOAD,\n      flags: Frames_1.Flags.COMPLETE,\n      streamId: this.streamId,\n      data: null,\n      metadata: null\n    });\n    this.stream.disconnect(this);\n  };\n  RequestStreamResponderStream.prototype.onExtension = function (extendedType, content, canBeIgnored) {\n    if (this.done) {\n      return;\n    }\n    this.stream.send({\n      type: Frames_1.FrameTypes.EXT,\n      streamId: this.streamId,\n      flags: canBeIgnored ? Frames_1.Flags.IGNORE : Frames_1.Flags.NONE,\n      extendedType: extendedType,\n      extendedContent: content\n    });\n  };\n  RequestStreamResponderStream.prototype.close = function (error) {\n    var _a;\n    if (this.done) {\n      console.warn(\"Trying to close for the second time. \".concat(error ? \"Dropping error [\".concat(error, \"].\") : \"\"));\n      return;\n    }\n    Reassembler.cancel(this);\n    (_a = this.receiver) === null || _a === void 0 ? void 0 : _a.cancel();\n  };\n  return RequestStreamResponderStream;\n}();\nexports.RequestStreamResponderStream = RequestStreamResponderStream;","map":{"version":3,"names":["require","Errors_1","Fragmenter_1","Frames_1","Reassembler","__importStar","RequestStreamRequesterStream","payload","receiver","fragmentSize","initialRequestN","leaseManager","streamType","FrameTypes","REQUEST_STREAM","prototype","handleReady","streamId","stream","done","connect","isFragmentable","_b","__values","fragmentWithRequestN","_c","next","frame","value","send","type","data","metadata","requestN","flags","undefined","Flags","METADATA","hasExtension","EXT","extendedContent","extendedType","handleReject","error","onError","handle","errorMessage","frameType","PAYLOAD","hasComplete","hasNext","hasFollows","disconnect","onComplete","hasFragments","reassemble","onNext","add","ERROR","cancel","RSocketError","code","message","concat","onExtension","hasIgnore","close","ErrorCodes","CANCELED","CANCEL","NONE","request","n","REQUEST_N","_a","cancelRequest","content","canBeIgnored","IGNORE","exports","RequestStreamResponderStream","handler","console","warn","APPLICATION_ERROR","isCompletion","fragment","NEXT","COMPLETE"],"sources":["../src/RequestStreamStream.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}