{"ast":null,"code":"import { defineComponent } from 'vue';\nimport { obtainSlot, getSuperSlot } from './utils';\nimport { build as optionSetup } from './option/setup';\nimport { build as optionComputed } from './option/computed';\nimport { build as optionData } from './option/data';\nimport { build as optionMethodsAndHooks } from './option/methodsAndHooks';\nimport { build as optionRef } from './option/ref';\nimport { build as optionWatch } from './option/watch';\nimport { build as optionProps } from './option/props';\nimport { build as optionInject } from './option/inject';\nimport { build as optionEmit } from './option/emit';\nimport { build as optionVModel } from './option/vmodel';\nimport { build as optionAccessor } from './option/accessor';\nimport { CustomRecords } from './custom/custom';\nfunction ComponentOption(cons, extend) {\n  const optionBuilder = {};\n  optionSetup(cons, optionBuilder);\n  optionVModel(cons, optionBuilder);\n  optionComputed(cons, optionBuilder); //after VModel\n  optionWatch(cons, optionBuilder);\n  optionProps(cons, optionBuilder);\n  optionInject(cons, optionBuilder);\n  optionEmit(cons, optionBuilder);\n  optionRef(cons, optionBuilder); //after Computed\n  optionMethodsAndHooks(cons, optionBuilder); //after Ref Computed\n  optionAccessor(cons, optionBuilder);\n  const setupFunction = optionBuilder.setup ? function (props, ctx) {\n    return optionBuilder.setup(props, ctx);\n  } : undefined;\n  const raw = Object.assign(Object.assign({\n    setup: setupFunction,\n    data() {\n      var _a;\n      delete optionBuilder.data;\n      optionData(cons, optionBuilder, this);\n      return (_a = optionBuilder.data) !== null && _a !== void 0 ? _a : {};\n    },\n    methods: optionBuilder.methods,\n    computed: optionBuilder.computed,\n    watch: optionBuilder.watch,\n    props: optionBuilder.props,\n    inject: optionBuilder.inject\n  }, optionBuilder.hooks), {\n    extends: extend\n  });\n  return raw;\n}\nfunction buildComponent(cons, arg, extend) {\n  const option = ComponentOption(cons, extend);\n  const slot = obtainSlot(cons.prototype);\n  Object.keys(arg).reduce((option, name) => {\n    if (['options', 'modifier', 'emits', 'setup'].includes(name)) {\n      return option;\n    }\n    option[name] = arg[name];\n    return option;\n  }, option);\n  let emits = Array.from(slot.obtainMap('emits').keys());\n  if (Array.isArray(arg.emits)) {\n    emits = Array.from(new Set([...emits, ...arg.emits]));\n  }\n  option.emits = emits;\n  CustomRecords.forEach(rec => {\n    rec.creator.apply({}, [option, rec.key]);\n  });\n  if (arg.setup) {\n    if (!option.setup) {\n      option.setup = arg.setup;\n    } else {\n      const oldSetup = option.setup;\n      const newSetup = arg.setup;\n      const setup = function (props, ctx) {\n        const newRet = newSetup(props, ctx);\n        const oldRet = oldSetup(props, ctx);\n        if (oldRet instanceof Promise || newRet instanceof Promise) {\n          return Promise.all([newRet, oldRet]).then(arr => {\n            return Object.assign({}, arr[0], arr[1]);\n          });\n        } else {\n          return Object.assign({}, newRet, oldRet);\n        }\n      };\n      option.setup = setup;\n    }\n  }\n  if (arg.options) {\n    Object.assign(option, arg.options);\n  }\n  if (arg.modifier) {\n    arg.modifier(option);\n  }\n  return defineComponent(option);\n}\nfunction build(cons, option) {\n  const slot = obtainSlot(cons.prototype);\n  slot.inComponent = true;\n  const superSlot = getSuperSlot(cons.prototype);\n  if (superSlot) {\n    if (!superSlot.inComponent) {\n      throw 'Class should be decorated by Component or ComponentBase: ' + slot.master;\n    }\n    if (superSlot.cachedVueComponent === null) {\n      throw 'Component decorator 1';\n    }\n  }\n  const component = buildComponent(cons, option, superSlot === null ? undefined : superSlot.cachedVueComponent);\n  component.__vfdConstructor = cons;\n  slot.cachedVueComponent = component;\n}\nfunction _Component(arg, cb) {\n  if (typeof arg === 'function') {\n    return cb(arg, {});\n  }\n  return function (cons) {\n    return cb(cons, arg);\n  };\n}\nexport function ComponentBase(arg) {\n  return _Component(arg, function (cons, option) {\n    build(cons, option);\n    return cons;\n  });\n}\nexport function Component(arg) {\n  return _Component(arg, function (cons, option) {\n    build(cons, option);\n    return obtainSlot(cons.prototype).cachedVueComponent;\n  });\n}","map":{"version":3,"names":["defineComponent","obtainSlot","getSuperSlot","build","optionSetup","optionComputed","optionData","optionMethodsAndHooks","optionRef","optionWatch","optionProps","optionInject","optionEmit","optionVModel","optionAccessor","CustomRecords","ComponentOption","cons","extend","optionBuilder","setupFunction","setup","props","ctx","undefined","raw","Object","assign","data","_a","methods","computed","watch","inject","hooks","extends","buildComponent","arg","option","slot","prototype","keys","reduce","name","includes","emits","Array","from","obtainMap","isArray","Set","forEach","rec","creator","apply","key","oldSetup","newSetup","newRet","oldRet","Promise","all","then","arr","options","modifier","inComponent","superSlot","master","cachedVueComponent","component","__vfdConstructor","_Component","cb","ComponentBase","Component"],"sources":["../../src/component.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}